---
title: "Gender-Mainstreaming Accessibility Analyses: Measuring Access to Care Destinations"
subtitle: "Measuring Access to Care"
author:
  - name: Anastasia Soukhov 
    email: soukhoa@mcmaster.ca
    affiliations: 
        - name: McMaster University
          department: School of Earth, Environment & Society 
          city: Hamilton
          state: Ontario, Canada
          postal-code: L8S 4L8
    attributes:
        corresponding: true
  - name: Léa Ravensbergen
    email: ravensbl@mcmaster.ca
    affiliations:
        - name: McMaster University
          department: School of Earth, Environment & Society 
          city: Hamilton
          state: Ontario, Canada
          postal-code: L8S 4L8
  - name: Nicholas Mooney
    email: mooneyn@mcmaster.ca
    affiliations:
        - name: McMaster University
          department: School of Earth, Environment & Society 
          city: Hamilton
          state: Ontario, Canada
          postal-code: L8S 4L8
abstract: |
  Accessibility, the ease of reaching opportunities, is an increasingly important tool amongst transport planners aiming to foster equitable and sustainable cities. However, in present research there is a bias in accessibility analyses towards employment-centric destinations, a destination more frequent for working-aged, and often higher income, men. This paper aims to counter this gendered bias by calculating access to care destinations, all destinations required to sustain household needs such as shopping, errands, and caring for others (children and dependents). Through the creation of a novel dataset of care destinations in the City of Hamilton, Canada, this paper considers access to care across different modes of transport at two timeframes (15-minute and 30-minute trips) using unconstrained (cumulative opportunity) and constrained (spatial availability) measures. Results indicate that travel to care destinations by car is extensively favoured, access to care by public transit and by foot is low in all parts of the city except some areas of the inner city. Access to care by bicycle is surprisingly high in many areas of the city, even beyond the downtown core. Neighbourhoods with both low access to care and a high proportion of low-income households are also identified as areas in need of intervention. The analysis presented in this paper demonstrates one method planners can use to gender-mainstream accessibility analyses. Further, results can inform policies aiming to encourage sustainable mobility. The manuscript and analysis is computationally reproducible and openly available to promote reproducible practice in transportation science.  
keywords: 
  - Accessibility
  - Mobility of Care
  - Gender
  - Cumulative Opportunity
  - Spatial Availability
date: last-modified
bibliography: bibliography.bib
format: 
  docx
  # elsevier-pdf:
  #   keep-tex: true
  #   journal:
  #     name: Journal of Transport Geography
  #     formatting: preprint
  #     model: 3p
  #     cite-style: super
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      cache= TRUE)
```

```{r library-setup}
library(sf)
library(here)
library(dplyr)
library(tmap)
library(mapview)
library(tmaptools)
library(pander)
library(flextable)
library(ftExtra)
library(scales)
```

```{r function-for-creating-comments-in-docx}
word_comment <- function(comment, highlight = "") {
  if (isTRUE(knitr:::pandoc_to() == "docx")) {
    paste0('[', comment, ']{.comment-start id="0" author="Anastasia"',
           'date="2024-01-06T15:00:00Z"}', highlight, '[]{.comment-end id="0"}')
  }
}
```

```{r spatial-availability-function}
sp_avail_detailed <- function(x, o_id, d_id, pop, opp, r, f, alpha = 1){
  
  o_id <- rlang::enquo(o_id)
  d_id <- rlang::enquo(d_id)
  pop <- rlang::enquo(pop)
  opp <- rlang::enquo(opp)
  r <- rlang::enquo(r)
  f <- rlang::enquo(f)
  
  sum_pop <- x |>
    dplyr::distinct(!!o_id,
                    .keep_all = TRUE) |>
    dplyr::mutate(sum_pop = !!r*(!!pop)^alpha) |>
    dplyr::pull(sum_pop) |>
    sum()
  
  f_p <- dplyr::pull(x, !!r) * dplyr::pull(x, !!pop)^alpha / sum_pop
  
  sum_impedance <- x |>
    dplyr::group_by(!!d_id) |>
    dplyr::summarize(sum_impedance = sum(!!f))
  
  x <- x |>
    dplyr::left_join(sum_impedance,
                     by = rlang::as_name(d_id))
  
  f_c <- dplyr::pull(x, !!f) / x$sum_impedance
  
  x$f_c <- f_c
  x$f_p <- f_p
  
  sum_pa <- x |>
    dplyr::group_by(!!d_id) |>
    dplyr::summarize(sum_pa= sum(f_p * f_c))
  
  x <- x |>
    dplyr::left_join(sum_pa,
                     by = rlang::as_name(d_id))
  x$f_t <- (f_p * f_c) / dplyr::pull(x, sum_pa)
  
  x |>
    dplyr::mutate(V_ij = !!opp * f_t)
}
```

```{r import-data, message=FALSE, include=FALSE}
#boundaries for mapping
hamilton_communities <- st_read(paste0(here::here(),"/data-raw/Boundaries/Community_Boundaries.shp")) |> mutate(COMMUNITY_ = ifelse(COMMUNITY_ == "Hamilton", "Hamilton-Central", COMMUNITY_))
ham_bound <- st_read(paste0(here::here(),"/data-raw/Boundaries/City_Boundary.shp"))

hydro_p_LakeOntario <- st_read(paste0(here::here(),"/data-raw/Boundaries/hydro_p_LakeOntario.shp")) |> st_transform(crs=4326)
ham_bay <- st_read(paste0(here::here(),"/data-raw/Boundaries/Waterbodies.shp")) |> st_transform(crs=4326) |> filter(FEATURE_TY == "Lake")
ham_streets <- st_read(paste0(here::here(),"/data-raw/Boundaries/Street_Centreline.shp")) |> st_transform(crs=4326) |> filter(ROAD_CLASS %in% c("Provincial Highway", "Parkway", "Arterial")) #no collectors, arterial, Local

#opportunities and population dataset 
load(paste0(here::here(),"/data-intermediate/care_dest.rda"))
load(paste0(here::here(),"/data-intermediate/HAM_census_21.rda"))
HAM_census_21 <- HAM_census_21 |>
  rename("LICO_AT_TOTAL" = `v_CA21_1085: Prevalence of low income based on the Low-income cut-offs, after tax (LICO-AT) (%)`) |> 
  mutate(LICO_AT_TOTAL = ifelse(is.na(LICO_AT_TOTAL), 0, LICO_AT_TOTAL)) |>
  rowwise() |> mutate(
         perc_walked = (`v_CA21_7647: Walked`)/sum(`v_CA21_7647: Walked`,`v_CA21_7635: Car, truck or van`, `v_CA21_7644: Public transit`,`v_CA21_7650: Bicycle`, `v_CA21_7653: Other method`, na.rm=TRUE),
         perc_car = (`v_CA21_7635: Car, truck or van`)/sum(`v_CA21_7647: Walked`,`v_CA21_7635: Car, truck or van`, `v_CA21_7644: Public transit`,`v_CA21_7650: Bicycle`, `v_CA21_7653: Other method`, na.rm=TRUE),
perc_transit = (`v_CA21_7644: Public transit`)/sum(`v_CA21_7647: Walked`,`v_CA21_7635: Car, truck or van`, `v_CA21_7644: Public transit`,`v_CA21_7650: Bicycle`, `v_CA21_7653: Other method`, na.rm=TRUE),
 perc_cycle_other = (`v_CA21_7650: Bicycle`+ `v_CA21_7653: Other method`)/sum(`v_CA21_7647: Walked`,`v_CA21_7635: Car, truck or van`, `v_CA21_7644: Public transit`,`v_CA21_7650: Bicycle`, `v_CA21_7653: Other method`, na.rm=TRUE),
pop_den = Population/`Shape Area`) |>
  select(c("GeoUID", "Population", "LICO_AT_TOTAL", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other", "pop_den"))

#calculated travel times
load(paste0(here::here(),"/data-intermediate/ttm_care_bike.rda"))
load(paste0(here::here(),"/data-intermediate/ttm_care_car.rda"))
load(paste0(here::here(),"/data-intermediate/ttm_care_transit.rda"))
load(paste0(here::here(),"/data-intermediate/ttm_care_walk.rda"))
```

```{r creating-fig1, eval=FALSE}
# Plot the map with different colors for each community and the transit lines layer
plot_hamilton_boundaries <- #first the lakes and streets
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  #next the hamilton community boundary layer 1, the streets, then community boundary 2 (black borders)
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons("COMMUNITY_",  palette = c("#365C8DFF", "#277F8EFF", "#1FA187FF", "#4AC16DFF", "#9FDA3AFF", "#FDE725FF"), title = "Hamilton Communities")+ #palette from (viridis::viridis(8))
  tm_shape(ham_streets) + tm_lines(col="lightgrey", lwd=0.5) +
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons(alpha=0, border.col = "black", lwd=1)+
  #next the text for the communities and then the scale bar, compass, and instruction for legend position
  tm_text(text = "COMMUNITY_", size = 1.25, col = "black", shadow = TRUE) +
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("left", "top"), size = 1.0) +
  tm_layout(bg.color = "grey", legend.position = c("right","top"))

plot_hamilton_boundaries
tmap_save(plot_hamilton_boundaries, filename ="figures/Fig1-boundaries.png", dpi=600)
```
```{r reformat care-dest specific categories}
care_dest <- care_dest |> 
  mutate(Care_Category_Specific = case_when(
    Care_Category_Specific  == "Daycare_EarlyON" ~ "EarlyON Daycare",
    Care_Category_Specific == "Community_Centre" ~ "Community Centre",
    Care_Category_Specific == "Daycare_Centre" ~ "Daycare",
    Care_Category_Specific == "Recreation_Centre" ~ "Recreation Centre",
    Care_Category_Specific == "School" ~ "School",
    Care_Category_Specific == "Long-Term_Care_Home" ~ "Long-Term Care Home",
    Care_Category_Specific == "Retirement_Home" ~ "Retirement Home",
    Care_Category_Specific == "Senior_Centre" ~ "Senior Centre",
    Care_Category_Specific == "Seniors_Active_Living_Centre" ~ "Seniors Active Living Centre",
    Care_Category_Specific == "Post_Office" ~ "Post Office",
    Care_Category_Specific == "Library" ~ "Library",
    Care_Category_Specific == "Banks" ~ "Banks",
    Care_Category_Specific == "Grocer_ConvenienceStore" ~ "Convenience Store",
    Care_Category_Specific == "Clinics" ~ "Clinics",
    Care_Category_Specific == "Grocer_Retail" ~ "Grocer",
    Care_Category_Specific == "Dentist" ~ "Dentist",
    Care_Category_Specific == "Hosptial" ~ "Hosptial",
    Care_Category_Specific == "Pharmacy" ~ "Pharmacy",
    Care_Category_Specific == "Park" ~ "Park"
  )) 
```

```{r creating-fig2s, eval=FALSE}
# Plot the map with the opportunity types
plot_care_categories <- 
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(hamilton_communities, bbox=hamilton_communities) + tm_polygons(col = "white", border.col = "black", lwd=1)+
  tm_shape(care_dest) + tm_dots("Care_Category_Specific", palette = RColorBrewer::brewer.pal(n = 6, name = 'Dark2'), size=0.025, title = "")+
  tm_facets("Care_Category", nrow = 3, free.scales= TRUE)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("left", "top"), size=0.9) +
  tm_layout(bg.color = "grey", panel.label.bg.color = "white", legend.position = c("right", "top"), legend.text.size = 0.5, legend.bg.color = "white", legend.bg.alpha = 0.4,
            panel.labels = c("1,190 Child-centric destinations", 
                             "75 Elder-centric destinations", 
                             "158 Errand-centric destinations", 
                             "381 Grocery-centric destinations", 
                             "421 Health-centric destinations"),
            panel.label.size = 0.8) 
plot_care_categories

tmap_save(plot_care_categories, filename ="figures/Fig2-plot_care_categories.png")
```
```{r}
# plot_care_categories <- image_read("figures/Fig2-plot_care_categories.png")
# magick::image_scale(plot_care_categories, "100") |> 
#   image_write("figures/Fig2-plot_care_categories.png")
```

```{r creating-fig3, eval=FALSE}
# Plot the map with the population
plot_all_pop <- 
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_census_21) +
  tm_polygons("Population", palette = "Greys", border.col = NULL,
              breaks = c(0,0.0001, 441    ,521    ,664   ,7631 ),
              labels = c("0",">0 to <441", "441 to <521", "521 to <664", "664 to 7631"),
              title = "Population")+
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons(alpha=0, border.col = "black", lwd=1)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("left", "top"), size = 1.0) +
  tm_layout(bg.color = "grey", legend.position = c("right","top"), legend.text.size = 0.6)

plot_all_pop_density <-
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_census_21) +
  tm_polygons("pop_den", palette = "Oranges", border.col = NULL,
              breaks = c(0,0.0001, 2057    ,3665    ,5389   ,72545 ),
              labels = c("0",">0 to <2057", "2057 to <3665", "3665 to <5389", "5389 to 72545"),
              title = "Pop. density (#/km2)")+
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons(alpha=0, border.col = "black", lwd=1)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("left", "top"), size = 1.0) +
  tm_layout(bg.color = "grey", legend.position = c("right","top"), legend.text.size = 0.6)

plot_low_income_pops <- 
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_census_21) +
  tm_polygons("LICO_AT_TOTAL", palette = "Reds", border.col = NULL,
              breaks = c(0, 0.0001, 2.4, 4.4, 8.4, 52),
            labels = c("0%", ">0% to <2.4%", "2.4% to <4.4%", "4.4% to <8.4%", "8.4% to 52%"),
              title = "LICO-AT (%)")+
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons(alpha=0, border.col = "black", lwd=1)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("left", "top"), size = 1.0) +
  tm_layout(bg.color = "grey", legend.position = c("right","top"), legend.text.size = 0.6)

plot_pops <- tmap_arrange(plot_all_pop,
                          plot_low_income_pops, plot_all_pop_density, nrow=2)
tmap_save(plot_pops, filename ="figures/Fig3-plot_pops.png", dpi=600)

rm(plot_all_pop,plot_low_income_pops,plot_all_pop_density)
#plot_pops
```

```{r augmenting the hamilton census object with modal splits}
#creating an object with modal splits
HAM_census_21_walk <- HAM_census_21 |> 
  mutate(perc_mode = ifelse(is.na(perc_walked), 0, 100*(perc_walked)),
         mode = "Walk")
HAM_census_21_car <- HAM_census_21 |> 
  mutate(perc_mode = ifelse(is.na(perc_car), 0, 100*(perc_car)),
         mode = "Car")
HAM_census_21_transit <- HAM_census_21 |> 
  mutate(perc_mode = ifelse(is.na(perc_transit), 0, 100*(perc_transit)),
         mode = "Transit")
HAM_census_21_cycle <- HAM_census_21 |> 
  mutate(perc_mode = ifelse(is.na(perc_cycle_other), 0, 100*(perc_cycle_other)),
         mode = "Cycle and other")
HAM_census_21_long <- rbind(HAM_census_21_walk, HAM_census_21_car, HAM_census_21_transit, HAM_census_21_cycle)
rm(HAM_census_21_walk, HAM_census_21_car, HAM_census_21_transit, HAM_census_21_cycle)
```

```{r plotting modal splits pop distribution}
plot_modal_splits <- tm_shape(ham_bay, bbox=hamilton_communities) + 
  tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) +
  tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_census_21_long) +
  tm_polygons("perc_mode", palette = "RdYlGn", border.col = NULL, breaks = c(0,10,20,30,40, 50, 60,70,80,90,100), style="cont", midpoint=50, legend.is.portrait=FALSE, title = "Population %")+
  tm_facets("mode", free.scales = FALSE)+
  tm_shape(hamilton_communities, bbox=hamilton_communities) +
  tm_polygons(alpha=0, border.col = "black", lwd=1)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size = 1.0) +
  tm_layout(bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.outside.position = "bottom",
            legend.position = c("center", "bottom"),
            legend.outside.size = 0.12)
#plot_modal_splits
tmap_save(plot_modal_splits, filename ="figures/Fig4-plot_modal_splits.png", dpi=600)
```

```{r re-weighting points so all destinations are considered spatially equal in access counts, include=FALSE}
Child_Centric <- 0.2*2225/1190
Elder_Centric <- 0.2*2225/75
Errand_Centric <- 0.2*2225/158
Grocery_Centric <- 0.2*2225/381
Health_Centric <- 0.2*2225/421

#adds up to 2225 opportunities  
0.2*2225/1190*(1190) + 0.2*2225/75*(75) +  0.2*2225/158*(158) + 0.2*2225/381*(381) + 0.2*2225/421*(421)

#adding the weighted care destination counts -- reweighted such that the 5 categories each make up 20% of the 2225 points.
care_dest <- care_dest |>
          mutate(Dest_count_weighted = case_when(Care_Category == "Child_Centric" ~ Child_Centric,
                                                 Care_Category == "Elder_Centric" ~ Elder_Centric,
                                                 Care_Category == "Errand_Centric" ~ Errand_Centric,
                                                 Care_Category == "Grocery_Centric" ~ Grocery_Centric,
                                                 Care_Category == "Health_Centric" ~ Health_Centric))

care_dest$Dest_count_weighted |> sum()
```

```{r 30 min and 15 min cumulative opps}
# the cumulative opp count for the number of care opportunities that can be reached within 30 mins or less:
ttm_car_30 <- ttm_care_car |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 30) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_walk_30 <- ttm_care_walk |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 30) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_bike_30 <- ttm_care_bike |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 30) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_transit_30 <- ttm_care_transit |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p25 <= 30) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

#15 mins or less
ttm_car_15 <- ttm_care_car |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 15) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_walk_15 <- ttm_care_walk |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 15) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_bike_15 <- ttm_care_bike |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p50 <= 15) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))

ttm_transit_15 <- ttm_care_transit |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |>
  filter(travel_time_p25 <= 15) |>
  group_by(from_id) |> 
  summarise(cum_opps = sum(Dest_count_weighted))
```

```{r 30 min and 15 min cumulative opps part 2}
#attaching the cum opps to sf object for mapping. First the 30 mins.
HAM_access_30_1 <- HAM_census_21 |>
  merge(ttm_car_30, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "a_car")

HAM_access_30_2 <-HAM_census_21 |>
  merge(ttm_transit_30, by.x="GeoUID", by.y="from_id",all.x=TRUE) |>
  mutate(mode = "b_transit")

HAM_access_30_3 <-HAM_census_21 |>
  merge(ttm_bike_30, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "c_bike")

HAM_access_30_4 <-HAM_census_21 |>
  merge(ttm_walk_30, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "d_walk")

HAM_access_30 <- rbind(HAM_access_30_1, HAM_access_30_2, HAM_access_30_3, HAM_access_30_4) |>
  mutate(cum_opps = ifelse(is.na(cum_opps), 0, cum_opps))

remove(HAM_access_30_1,HAM_access_30_2,HAM_access_30_3,HAM_access_30_4)

# the 15 mins
HAM_access_15_1 <- HAM_census_21 |>
  merge(ttm_car_15, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "a_car")

HAM_access_15_2 <-HAM_census_21 |>
  merge(ttm_transit_15, by.x="GeoUID", by.y="from_id",all.x=TRUE) |>
  mutate(mode = "b_transit")

HAM_access_15_3 <-HAM_census_21 |>
  merge(ttm_bike_15, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "c_bike")

HAM_access_15_4 <-HAM_census_21 |>
  merge(ttm_walk_15, by.x="GeoUID", by.y="from_id", all.x=TRUE) |>
  mutate(mode = "d_walk")

HAM_access_15 <- rbind(HAM_access_15_1, HAM_access_15_2, HAM_access_15_3, HAM_access_15_4) |>
  mutate(cum_opps = ifelse(is.na(cum_opps), 0, cum_opps))

remove(HAM_access_15_1,HAM_access_15_2,HAM_access_15_3,HAM_access_15_4)
```

```{r ploting cumulative opportunities, eval=FALSE}
#plotting the cumulative opportunity measure results
plot_cum_opp_30m <- 
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_30) +
  tm_polygons("cum_opps",
              palette = "Purples",
              breaks = c(0,0.0001, 68, 281, 858, 2209),
              labels = c("0",">0 to <68", "68 to <281", "281 to <858", "858 to 2209"),
              border.alpha = 0,
              title = "No. of dest. within 30 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)

plot_cum_opp_15m <- 
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_15) +
  tm_polygons("cum_opps",
              palette = "Greens",
              breaks = c(0,0.0001, 11, 52, 285, 1939),
              labels = c("0",">0 to <11", "11 to <52", "52 to <285", "285 to 1939"),
              border.alpha = 0,
              title = "No. of dest. within 15 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)
plot_cum_opp_measures <- tmap_arrange(plot_cum_opp_15m, plot_cum_opp_30m, asp=1/1.5)
plot_cum_opp_measures
tmap_save(plot_cum_opp_measures, filename ="figures/Fig5-plot_cum_opp_measures.png", dpi=600)
rm(plot_cum_opp_15m,plot_cum_opp_30m)
```

```{r calcing spatial availability part one}
# here I calculate the proportion of population taking each mode and their 'f' (1 if travel time is under 30 mins or 15 mins). I do 30 min first. Then 15 min. I stack all these objects togther and use this object to later calc spatial availability. 
ttm_car_30 <- ttm_care_car |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 30, 1, 0)) |>
  merge(HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> select(c("GeoUID", "Population", "perc_car", "mode")), by.x = "from_id", by.y = "GeoUID") |>
  mutate(Population = Population*perc_car) |> select(-c("perc_car"))

ttm_walk_30 <- ttm_care_walk |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 30, 1, 0)) |>
  merge(HAM_access_30 |> st_drop_geometry() |> filter(mode == "d_walk") |> select(c("GeoUID", "Population", "perc_walked", "mode")), by.x = "from_id", by.y = "GeoUID") |>
  mutate(Population = Population*perc_walked) |> select(-c("perc_walked"))

ttm_bike_30 <- ttm_care_bike |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 30, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_30 |> st_drop_geometry() |> filter(mode == "c_bike") |> select(c("GeoUID", "Population", "perc_cycle_other", "mode")), by.x = "from_id", by.y = "GeoUID") |>
  mutate(Population = Population*perc_cycle_other) |> select(-c("perc_cycle_other"))

ttm_transit_30 <- ttm_care_transit |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p25 <= 30, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_30 |> st_drop_geometry() |> filter(mode == "b_transit") |> select(c("GeoUID", "Population", "perc_transit", "mode")), by.x = "from_id", by.y = "GeoUID") |>
  mutate(Population = Population*perc_transit) |> select(-c("perc_transit"))

#15 mins or less
ttm_car_15 <- ttm_care_car |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 15, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_15 |> st_drop_geometry() |> filter(mode == "a_car") |> select(c("GeoUID", "Population", "perc_car", "mode")), by.x = "from_id", by.y = "GeoUID")|>
  mutate(Population = Population*perc_car) |> select(-c("perc_car"))

ttm_walk_15 <- ttm_care_walk |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 15, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_15 |> st_drop_geometry() |> filter(mode == "d_walk") |> select(c("GeoUID", "Population", "perc_walked", "mode")), by.x = "from_id", by.y = "GeoUID")|>
  mutate(Population = Population*perc_walked) |> select(-c("perc_walked"))

ttm_bike_15 <- ttm_care_bike |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p50 <= 15, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_15 |> st_drop_geometry() |> filter(mode == "c_bike") |> select(c("GeoUID", "Population", "perc_cycle_other", "mode")), by.x = "from_id", by.y = "GeoUID")|>
  mutate(Population = Population*perc_cycle_other) |> select(-c("perc_cycle_other"))

ttm_transit_15 <- ttm_care_transit |> merge(care_dest |> st_drop_geometry() |> select(c("ID", "Dest_count_weighted")), by.x = "to_id", by.y = "ID") |> 
  mutate(f = ifelse(travel_time_p25 <= 15, 1, 0) #,Dest_count = 1
         ) |>
  merge(HAM_access_15 |> st_drop_geometry() |> filter(mode == "b_transit") |> select(c("GeoUID", "Population", "perc_transit", "mode")), by.x = "from_id", by.y = "GeoUID")|>
  mutate(Population = Population*perc_transit) |> select(-c("perc_transit"))

ttm_ALL_30 <- rbind(ttm_car_30, ttm_walk_30, ttm_bike_30,ttm_transit_30) |>
  mutate(Population = ifelse(is.na(Population), 0, Population))
rm(ttm_car_30, ttm_walk_30, ttm_bike_30,ttm_transit_30)

ttm_ALL_15 <- rbind(ttm_car_15, ttm_walk_15, ttm_bike_15,ttm_transit_15) |>
  mutate(Population = ifelse(is.na(Population), 0, Population))
rm(ttm_car_15, ttm_walk_15, ttm_bike_15,ttm_transit_15)
```

```{r calculating spatial availability part two, include=FALSE}
Savail_BYMODE_30 <- ttm_ALL_30 |>
  mutate(catch = 1) |>
  sp_avail_detailed(o_id = from_id, #the DA centroid
                    d_id = to_id, #the care destination point
                    pop = Population, #the population of the DA using that mode
                    opp = Dest_count_weighted,
                    r = catch,
                    f = f,
                    alpha = 1) |>
  group_by(from_id) |>
  group_by(from_id, mode) |> summarize(V_im = sum(V_ij, na.rm = TRUE))

Savail_BYMODE_30$V_im |> sum(na.rm = TRUE) #sums to 2225 opportunities

#now 15 mins
Savail_BYMODE_15 <- ttm_ALL_15 |>
  mutate(catch = 1) |>
  sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count_weighted, r = catch, f = f, alpha = 1)|>
  group_by(from_id, mode) |> summarize(V_im = sum(V_ij, na.rm = TRUE))

Savail_BYMODE_15$V_im |> sum(na.rm = TRUE) #sums to 2225 opportunities
```

```{r calculating spatial availability part three, include=FALSE}
#attaching the cum opps to sf object for mapping. First the 30 mins.
HAM_access_30 <- HAM_access_30 |> 
  merge(Savail_BYMODE_30, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode"), all.x=TRUE) |>
  mutate(V_im = ifelse(is.na(V_im), 0, V_im),
         v_im = case_when(mode == "a_car" ~ V_im/(Population*perc_car),
                                  mode == "c_bike" ~ V_im/(Population*perc_cycle_other),
                                  mode == "d_walk" ~ V_im/(Population*perc_walked),
                                  mode == "b_transit" ~ V_im/(Population*perc_transit)),
         v_im = ifelse(is.nan(v_im) | is.na(v_im), 0, v_im))

# the 15 mins
HAM_access_15 <- HAM_access_15 |> 
  merge(Savail_BYMODE_15, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode"), all.x=TRUE) |>
  mutate(V_im = ifelse(is.na(V_im), 0, V_im),
         v_im = case_when(mode == "a_car" ~ V_im/(Population*perc_car),
                                  mode == "c_bike" ~ V_im/(Population*perc_cycle_other),
                                  mode == "d_walk" ~ V_im/(Population*perc_walked),
                                  mode == "b_transit" ~ V_im/(Population*perc_transit)),
         v_im = ifelse(is.nan(v_im)| is.na(v_im), 0, v_im))

HAM_access_30$V_im |> sum(na.rm=TRUE) #sums to 2225 opportunities
HAM_access_15$V_im |> sum(na.rm=TRUE) #sums to 2225 opportunities
```

```{r calculating spatial availability part four, include=FALSE}
#creating spatial availability objects that sum up all modes and are just 1 row 1 GeoUID
HAM_access_30_ALLMODE_Savail <- HAM_access_30 |> 
  group_by(GeoUID) |>
  summarize(V_i = sum(V_im)) 

# the 15 mins
HAM_access_15_ALLMODE_Savail <- HAM_access_15 |> 
  group_by(GeoUID) |>
  summarize(V_i = sum(V_im)) 

HAM_access_30_ALLMODE_Savail$V_i |> sum(na.rm=TRUE) #sums to 2225 opportunities
HAM_access_15_ALLMODE_Savail$V_i |> sum(na.rm=TRUE) #sums to 2225 opportunities
```

```{r plotting spatial availability part 1, eval=FALSE}
#plotting the spatial availability measure results
plot_Savail_30m <-
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_30) +
  tm_polygons("V_im",
              palette = "Purples",
              # breaks = c(0, 0.0000000001, 0.000000001, 0.0001288 , 0.0025651 , 0.0046746 ),
              breaks = c(0, 0.0000000001, 0.000000001, 0.00515, 0.39719, 28.80745),
              labels = c("0","0", "0 to <0.005", "0.005 to <0.40", "0.40 to 28.81"),
              border.alpha = 0,
              title = "Spatially available destinations within 30 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)

plot_Savail_15m <-
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_15) +
  tm_polygons("V_im",
              palette = "Greens",
              # breaks = c(0,0.0000000001, 0.000000001, 0.0000345, 0.0009846, 0.0089849),
              breaks = c(0,0.0000000001, 0.000000001, 0.001505, 0.151288, 13.522106),
              labels = c("0","0", "0 to <0.002", "0.002 to <0.15", "0.15 to 13.52"),
              border.alpha = 0,
              title = "Spatially available destinations within 15 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)

plot_Savail_measures <- tmap_arrange(plot_Savail_15m, plot_Savail_30m, asp=1/1.5)
plot_Savail_measures
tmap_save(plot_Savail_measures, filename ="figures/Fig6-plot_Savail_measures.png", dpi=600)
#rm(plot_cum_opp_15m,plot_cum_opp_30m)
```

```{r plotting spatial availability part 2, eval=FALSE}
#plotting the spatial availability measure results
plot_Savail_smallv_30m <-
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_30) +
  tm_polygons("v_im",
              palette = "Purples",
              breaks = c(0, 0.0000000001, 0.000000001, 0.0001288 , 0.0025651 , 0.0046746 ),
              labels = c("0","0", "0 to <0.0001", "0.0001 to <0.0026", "0.0026 to 0.0047"),
              border.alpha = 0,
              title = "Spatially available destinations per mode-using-capita within 30 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)

plot_Savail_smallv_15m <-
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_15) +
  tm_polygons("v_im",
              palette = "Greens",
              breaks = c(0,0.0000000001, 0.000000001, 0.0000345, 0.0009846, 0.0089849),
              labels = c("0","0", "0 to <0.00004", "0.00004 to <0.00098", "0.00098 to 0.0090"),
              border.alpha = 0,
              title = "Spatially available destinations per mode-using-capita within 15 mins.",
              legend.is.portrait = FALSE) +
  tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(panel.labels=c("Car","Transit","Bike","Walk"),
            bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)

plot_Savail_smallv_measures <- tmap_arrange(plot_Savail_smallv_15m, plot_Savail_smallv_30m, asp=1/1.5)
plot_Savail_smallv_measures
tmap_save(plot_Savail_smallv_measures, filename ="figures/Fig7-plot_Savail_smallv_measures.png", dpi=600)
#rm(plot_Savail_smallv_15m,plot_Savail_smallv_30m)
```

```{r plotting spatial availability for 30 min all modes summed together, eval=FALSE}
  tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) +
  tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+
  tm_shape(HAM_access_30_ALLMODE_Savail) +
  tm_polygons("V_i",
              palette = "Purples",
              breaks = c(0,0.0001,1.699, 2.078, 2.642, 28.817 ),
              labels = c("0",">0 to <1.7", "1.7 to <2.1", "2.1 to <2.6", "2.6 to 28.8"),
              border.alpha = 0,
              title = "Spatially available destinations within 30 mins.",
              legend.is.portrait = FALSE) +
  tm_shape(hamilton_communities) + tm_polygons(alpha=0)+
  tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) +
  tm_compass(position = c("right", "top"), size=1.0)+
  tm_layout(bg.color = "grey",
            panel.label.bg.color = "white",
            panel.label.color = "black",
            legend.outside = TRUE,
            legend.position = c("center", "bottom"),
            legend.outside.position = "bottom",
            legend.outside.size = 0.2,
            legend.title.size = 0.7,
            legend.text.size = 0.5)
```

# INTRODUCTION
A gender bias exists in transport research and policy. The field has historically focused on one trip purpose; the on-peak commute to work, which is a travel pattern more frequent amongst men [@sanchezdemadariagaMobilityCareIntroducing2013]. Women, on the other hand, have been found to complete more household-serving travel than men, such as escorting children [@craigGenderMobilityParental2019; @taylorWhatExplainsGender2015; @hanTaskAllocationGender2019; @mcdonaldExploratoryAnalysisChildren2006], shopping, and errand trips [@taylorWhatExplainsGender2015;@rootWomenTravelIdea2000; @sweetGenderDifferencesRole2016]. These household-serving trips tend to take place near the home and are therefore short in length and/or duration [@ravensbergenExploratoryAnalysisMobility2022]. Further, they are often made as part of a trip-chain, i.e., as a stop between one’s trip origin and their final destination (e.g., dropping off children at daycare on your way from home to work) [@scheinerWomenComplexDaily2015]. 

(@sanchezdemadariagaMobilityCareIntroducing2013; @sanchezdemadariagaMeasuringMobilitiesCare2019) argues that these household-serving trips are systematically under-represented, under-counted, and rendered invisible due to masculinist biases in transport planning. Take, for instance, how trips to household sustaining destinations such as grocery stores, healthcare, and types of recreation including green space and community centres, are categorised in typical large-scale travel surveys [@sanchezdemadariagaMobilityCareIntroducing2013], including major Canadian surveys such as the Transportation Tomorrow Survey [@transportationtomorrowsurvey2022] the Montréal Origin-Destination Survey [@autoriteregionaldetransportmetropolitainEnqueteOrigineDestination20182022]. 
Specifically, in the TTS, households are surveyed to understand complete motorised trips (and non-motorised chained-trips) that are either home-work, home-school, non-home, or home-discretionary based. Though purposes of trip origins and destinations like shopping, leisure, daycare (as well as the typical work, school or home) can be identified, the focus of the survey is indeed on what is a 'typical' trip [@transportationtomorrowsurvey2022]. Other trips are as a by-product, 'non-typical' and minimialised in importance. People's travel behaviour are complex and surveys' must balance detail with summary, but the aggregation steers data-driven solutions from counted and observed home -work/-school based trips `r word_comment("maybe some discussion here of what a non- mobility-of-care trip is why those are centered historically? Gov's role in providing transport infrastructure to serve economics and other 'city provided' resources like school seats?", ".")`

What is seen as a 'typical' trip continues to shape transport and land-use. To counter this bias, @sanchezdemadariagaMobilityCareIntroducing2013 developed the concept ‘mobility of care’; it refers to all the travel needed to fulfill household needs (e.g., a combination of travel to grocery stores, errands, and pick-up / drop-off of children).  When travel surveys are designed to explicitly capture mobility of care, preliminary research has found that it comprises approximately one third of adults’ trips [@sanchezdemadariagaMobilityCareIntroducing2013;@sanchezdemadariagaMeasuringMobilitiesCare2019; @ravensbergenExploratoryAnalysisMobility2022]. The omission of mobility of care in research and planning has important equity considerations. Not only are mobility of care trips completed predominantly by women, this gendered discrepancy is greater in low-income households [@sanchezdemadariagaMobilityCareIntroducing2013; @ravensbergenExploratoryAnalysisMobility2022]. For instance, in lower income households in Montréal, women complete 50% more care trips than men [@ravensbergenExploratoryAnalysisMobility2022].

The power of the Mobility of Care concept lies in its ability to highlight the masculinist bias in transport research – travel for care appears insignificant because travel surveys are not written to capture it [@sanchezdemadariagaMobilityCareIntroducing2013]. Travel surveys, however, are but one tool used by transport researchers and practitioners. Another popular tool in transport planning and research is accessibility, an indicator that quantifies “the potential of opportunities for interaction” as defined in the seminal work of @hansenHowAccessibilityShapes1959. Accessibility indicators can be interpreted as the ease of reaching destinations using transport networks - a byproduct of mobility and a representation of the people's interaction with land-use and transportation systems [@hansenHowAccessibilityShapes1959; @handyAccessibilityIdeaWhose2020; @elgeneidyMakingAccessibilityWork2021]. The points of interest in many accessibility-based assessments have been home-to-work destinations [@kelobonyeRelativeAccessibilityAnalysis2019; @farberOntarioLineSocioeconomic2019; @duarteInfluenceJobAccessibility2023; @ryanAccessibilitySpaceTime2023]. For example, in the accessibility assessment of the Ontario Line, a subway line that will be constructed in the city of Toronto, Canada, @farberOntarioLineSocioeconomic2019 highlight how this new investment will increase access to jobs for residents across the City by 1.14% overall. While much has been learnt in these analyses, moving away from jobs as the default destination may open opportunities for gender-mainstreaming accessibility analyses. Indeed, jobs are not always the most significant destination for many segments of the population. On average, women's commutes comprise a smaller proportion of their daily travel than men's [@ravensbergenExploratoryAnalysisMobility2022]. This focus on job-access can additionally bias accessibility-gains that children and older adults who reside in impacted areas may see as well [@grantsmithManagingChallengesCombining2016]. One way to counter this bias is to reframe accessibility analysis by explicitly considering destinations involved in mobility of care.

Reframing accessibility analyses to incorporate mobility of care is also pertinent to the promotion of sustainable travel modes in cities. Research has found that people are less likely to use public transport or bicycles for care trips [@ravensbergenExploratoryAnalysisMobility2022] and more likely to make these trips by car [@maciejewskaHaveChildrenThus2019; @ravensbergenExploratoryAnalysisMobility2022]. A lack of access to care destinations by bicycle and transit may contribute to these trends. Mobility of care are also more commonly completed by foot than the commute to work [@ravensbergenExploratoryAnalysisMobility2022]. Whether there is a relationship between these travel behaviors and people’s access to care destination using different modes, however, remains unknown, as mobility of care is largely uncounted.

In this spirit, this study foregrounds the theoretical mobility of care concept by calculating the accessibility to care destinations or multiple modes in an empirical case study of Hamilton, Canada. Two place-based accessibility measures are used to motivate the discussion: one unconstrained measure (cumulative opportunity) and another constrained measure (spatial availability). This research aims to contribute to gender mainstreaming in transport planning by demonstrating an approach to feminist accessibility calculation and interpretation `r word_comment("spatial availability also helps _improve_ the interpretation of accessibility numbers. each zone can access a % of the total opportunities. they can help inform explicit distributional policy -- like no neighbourhood should have below a certain %. If a new LRT is added + more destinations are added downtown, this may result in more peripheral neighbourhoods following below this certain %.", ".")`

# BACKGROUND AND METHODS

This paper focuses on Hamilton, a mid-size city of approximately 500,000 residents and an economy historically (and still) connected to steel manufacturing and related manufacturing. Hamilton lies within the urban and suburban Greater Toronto and Hamilton Area (GTHA) [@transportationtomorrowsurvey2022]. The GTHA is home to seven million people, or approximately 20% of the Canadian population [@cityoftoronto2021CensusPopulationa2022]. 
Hamilton is divided into six regional communities: Hamilton Central, Dundas, Ancaster, Flamborough, Stoney Creek and Glanbrook (@fig-Fig1). Each of these regions demonstrate different characteristics of the urban and suburban landscape of the city. Hamilton Central is the densest and most urbanized of the six, and the five periphery regions of Dundas, Ancaster, Flamborough, Glanbrook and Stoney Creek are significantly more suburbanized with the furthest periphery regions being undeveloped or rural owing to their inclusion in the region’s greenbelt [@greenbeltfoundationThrivingGreenbeltThriving2023]. These urban, suburban, and rural landscapes likely play a key role in accessing care as differences in infrastructure could affect one’s ability to access care destinations. <!-- ended here! -->

```{r plot-figure1, out.width=600}
#| label: fig-Fig1
#| fig-cap: "The six former muncipal boundaries in the city of Hamilton. Basemap shapefiles are retrieved from the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]. Highways and arterial roads are shown in light grey."
knitr::include_graphics("figures/Fig1-boundaries.png") 
```

## Destination dataset
To complete the accessibility analysis, a geospatial dataset of care destinations for Hamilton (e.g., full addresses of longitude and latitude) was compiled. The geospatial data was sourced from provincial and municipal open data portals [@governmentofontarioOntarioDataCatalogue2023; @cityofhamiltonOpenData2023], Data Axle, a consumer dataset compiled of businesses and companies within Canada [@axledataConsumerData2023] or manually through Google Maps. Each destination was categorized based on the specific type of care being accessed. Categories include child, elder,  grocery, health, and errand -centric destinations `r word_comment("how are these categories determined? Is this from literature or are we suggesting these types of categories to be used in mobility of care analysis. If that's what we're suggesting we should note i.e., _as an empirical analysis of the theoretical concept of mobility of care, this one way care destinations can be theorised_" , ".")` Of note are errand-centric destinations, in conventional travel surveys these destinations are often lumped in within 'grocery shopping' [@taylorWhatExplainsGender2015]. In this research, they are distinguished from child-, elder-, grocery- and health-centric destinations `r word_comment("I don't think this justification is very strong." , ".")` These final categories, and their sources of data, are detailed in TABLE 1 and their spatial distribution and sub-categories are visualised in @fig-Fig2.

`r word_comment("why are community centres and rec centres considered child-centric?", ".")`
`r word_comment("NOTE: my dream is to have 1 page table, with two columns. A small visual of each map and a decription of each source... But I fear even if I rotate Hamilton (to eliminate white space) and stack all 5 categories on top of each other, the maps will be too small. If it bleeds into being 2 pages, then what we have here (first table and then maps) is good enough. What do you think?", ".")`
```{r creating-table-content}
dat <- data.frame(matrix(c("Child-centric",
                           "Includes all child-oriented destinations: schools, daycares, community centres, recreation centres, and parks: 1,190 locations are identified. Schools are sourced from the Educational Institution dataset [@opendatahamiltonEducationalInstitutions2022]. After manual review, all locations that typically do not serve children were removed including: Post-Secondary, Adult-Learning Centres, Group Homes, and Foster Care Centres. Through examination some Section 23 institutions defined as _“centres for children who cannot attend school to meet the needs of care or treatment, and rehabilitation”_ [@governmentofontarioministryofeducationFundingEducationCommunity2023], were kept due to their innate connection to care. Daycares were identified from the Ontario Registered Child Care Facilities dataset [@governmentofontarioOntarioDataCatalogue2023]. EarlyON childcare, defined as _“…locations for child rearing and development where parents accompany their children”_ [@cityofhamiltonChildCareRegistry2023], were added manually from the Child Care Registry [@cityofhamiltonChildCareRegistry2023]. Community centres, recreation centres, and Parks were identified from the Recreation and Community Centres and Parks datasets respectively [@opendatahamiltonParksdataset2022; @opendatahamiltonRecreationCommunityCentres2022].",
                           "Elder-centric",
                           "Includes locations of senior centres, long-term care homes, and retirement homes: 75 destinations are identified. Locations labelled _Senior centres_ are retrieved from the Recreation and Community Centre dataset [@opendatahamiltonRecreationCommunityCentres2022]. Long-term care homes and retirement homes are sourced from the Ontario Health Service Locations dataset [@ontarioministryofhealthgeohubMinistryHealthService2023].",
                           "Grocery-centric",
                           "Includes all types of grocery stores, namely a place a household could buy groceries ranging from convenience stores to large retail stores: 381 destinations are identified. Data is gathered from @axledataConsumerData2023 and filtered by Company Name, Suite Number, Address, City, Province, Phone Number and Postal Code. The type was then identified e.g., grocers specialty foods, grocers retail, grocer health food, grocer wholesale, grocer curbside, grocer delicatessen wholesale, grocer convenience. Data was crossreferenced to ensure all included locations were operational and legitimate grocery stores.",
                           "Health-centric",
                           "Includes hospitals, pharmacies, clinics, and dentist offices: 421 destinations are identified. Hospitals and pharmacies were derived from Ontario Health Service Locations dataset [@ontarioministryofhealthgeohubMinistryHealthService2023]. Clinics were manually scraped from the Health Services Locations dataset and checked via Google Maps to remove non-operational locations [@hamiltonniagarahaldimandbranthealthlineWalkInMedicalClinics2023]: some locations were dentistry-orientated, those were labelled accordingly. ",
                           "Errand-centric",
                           "Includes other types of destinations that are errand-centric such as libraries, post offices, and banks: 158 destinations are identified. Libraries are derived from @opendatahamiltonLibraries2022. Post Offices are collected from an Axle dataset and missing locations are retrieved from the Canada Post Postal Office Tracker Website [@axledataConsumerData2023;@canadapostPostOfficeLocator2023]. Banks are also derived from Axle Data and then cross referenced to ensure data quality with the a Bank Locator website for all national banking firms: Bank of Montreal, CIBC, HSBC, National Bank of Canada, Royal Bank of Canada, Scotiabank and TD Financial [@bankofmontrealBankMontrealBranch2023; @thehongkongandshanghaibankingcorporationlimitedhsbcHSBCBranchABM2023; @nationalbankNationalBankBranches2023; @royalbankofcanadaRBCBranchABM2023; @scotiabankScotiabankABMBranch2023; @thetorontodominionbankTDBankBranch2023]."
                           ), ncol = 2, byrow = T))
```

```{r creating-table}
set_flextable_defaults(font.size= 10,
                       font.family = NULL,
                       text.align = 'justify')

flextable(dat) %>%
  ftExtra::colformat_md() %>%
  compose(
    i = 1, j = c(1,2), part = "header", value = as_paragraph(c("Care category", "Description of sources"))) %>%
  set_table_properties(layout = "autofit")
  
```

```{r plot-figure2, out.width=600}
#| label: fig-Fig2
#| fig-cap: "The geo-located points of care destinations in the City of Hamilton separated by the author-generated categories of: child-, elder-, errand-, grocery- and health- centric care categories. Locations of these destinations were retrieved through multiple sources as described in the text. Basemap shapefiles are sourced from the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig2-plot_care_categories.png")
```

For the purpose of this analysis and in absence of city-wide empirical household preferences for care destinations, all destinations are re-weighted to be conceptually equal. If this was not done, all locations would as one. destination in the analysis and the results will favour access to child-centric destinations as they make up the majority of the dataset. Accessibility literature has weighted destinations in a variety of ways, namely by the destinations assumed capacity [e.g., @liMeasuringMultiactivities2024] or by travel to destination zones [e.g., @graellsCityCitiesMeasuring2021]. Both these approaches do not serve this work's empirical case as the focus is on household-serving care destinations so some do not have traditional 'capacities' like health care facilities have beds, and travel to destination zones by _all_ modes to these destinations have not been counted [@transportationtomorrowsurvey2022]. So, in this analysis, the five care categories are simply re-weighted so they each represent one-fifth of the dataset, conceptually all categories are equal in importance to the population that may live in each zone. 

- Child-centric (`r sum(care_dest$Care_Category == "Child_Centric")` destinations each at `r Child_Centric`), 
- Elder-centric (`r sum(care_dest$Care_Category == "Elder_Centric")` destinations each at `r Elder_Centric`),
- Errand-centric (`r sum(care_dest$Care_Category == "Errand_Centric")` destinations each at `r Errand_Centric`),
- Grocery-centric (`r sum(care_dest$Care_Category == "Grocery_Centric")` destinations each at `r Grocery_Centric`) and,
- Health- centric (`r sum(care_dest$Care_Category == "Health_Centric")` destinations each at `r Health_Centric`) . 

## Census data and multimodal travel time estimations 
To supplement the care destination dataset and complete the accessibility calculation, population data for the City of Hamilton was sourced from the most recent 2021 Canadian census [@governmentofcanadaCensusPopulation2023]. The number of residents and the percent of after-tax low-income-cut-off (LICO-AT) residents was sourced at the highest level of spatial resolution, the dissemination area (DA). LICO-AT is a composite indicator included in the census that reflects the proportion of households spending 20% more than the area average on food, shelter and clothing [@governmentofcanadaLowIncomeCutoffs2023]. The {cancensus} open-sourced R package was used to access the 2021 Canadian Census data in a programmatic way [@vonbergmannCancensusCensusMapper2021]. @fig-Fig3 displays the spatial distribution of the total population and the prevalence of LICO-AT as a percentage of the total population. Of note is the density of population and LICO-AT prevalence within Hamilton-Central.

```{r plot-figure3, out.width=600}
#| label: fig-Fig3
#| fig-cap: "The total population in each dissemination area (DA), visualized with the six former muncipal boundaries in the city of Hamilton. The top plot represents the population density and the bottom plot depicts the prevalence of low-income cutt-off after taxes (LICO-AT) as a percentage of the total DA population. LICO-AT is a measure of economic disadvantage. The legend categories represent quartiles. Basemap shapefiles are retrieved from the 2021 Canadian census [@governmentofcanadaCensusPopulation2023], the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig3-plot_pops.png")
```

To further investigate the spatial differences in access to care that modes offer, we use the proportion of the total population that commute by a specific mode (@fig-Fig4). These variables are also retrieved as a long-form variable of the 2021 Canadian census using the {cancensus} R Package [@governmentofcanadaCensusPopulation2023; @vonbergmannCancensusCensusMapper2021]. Though mode-choice used in travel to work is not necessarily reflective of the mode used to travel to care destinations, no other data is available City-wide. <!-- the bias, discussed -->That said, the population predominately commutes by car, even within the more densely populated Hamilton-Central.
```{r plot-figure4, out.width=600}
#| label: fig-Fig4
#| fig-cap: "The proportion of mode type used for commuting (aged 15 and older employed in the labour force) in each dissemination area (DA) as provided by the 2021 Canadian census. Basemap shapefiles are retrieved from the 2021 Canadian census [@governmentofcanadaCensusPopulation2023], the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig4-plot_modal_splits.png")
```
Travel time is conducted using the 'travel_time_matrix()' function from {r5r}, an open-source R package for rapid realistic routing on multimodal transport networks [@pereiraR5rRapidRealistic2021]. The inputs were the geometric centroids of the DA, the centroids of all care destinations, the Open Street Map (OSM) road network retrieved from Geofabrik, [@geofabrikOntarioCanadaOpen2023] and the static GTFS (transit network in which only urban buses operate) for Hamilton [@transitfeedsHamiltonStreetRailway2023]. Travel times for walking, cycling, transit (with walking to stations), and car were calculated for each origin to all care destinations.

For all modes, travel times under 60 minutes based on the shortest travel-time path OSM road network were calculated. For transit and cycling modes, additional parameters were included. In estimating transit travel times, a typical Wednesday departure time at 8:00 was selected, as it is representative of relative accessibility over the course of the day [@boisjolyDailyFluctuationsTransit2016]. Further, a departure travel window parameter of +/- 30 mins was used, so the origin-destination travel times are calculated for each minute between 7:30 to 8:30. This consider is important as transit travel times are highly sensitive to vehicle frequency and connecting transfers (see discussion of the modifiable temporal unit problem e.g., [@pereiraFutureAccessibilityImpacts2019]). After evaluation, the 25th percentile travel time from the distribution of travel times in the window was selected to represent each OD trip. This travel time indicates that 25% of trips from that origin to destination have a travel time that is that length or shorter. This assumption provides an optimistic assumption of transit travel times. For cycling travel times, the default parameter for cycling routes of level 1 or 2 traffic level of stress, dedicated or separated cycling lanes respectively, was selected. The level of traffic stress is variable associated with links of the OSM road network.

## Accessibility measures

Both the **cumulative opportunity** and **spatial availability** measure are used to estimate the potential access to care that each mode provides to the DA. These measures represent the aggregate zonal (DA) accessibility that populations that reside within those DA may have access. 

**Cumulative opportunity accessibility**: takes the following general form for multi-mode calculation:
$$
A_i^m=\sum_{j=1}^{J}O_j\cdot f^m(c_{ij}^m)
$$
\noindent Where:

- $i$ is a set of origin locations.
- $j$ is a set of destination locations.
- $m$ is a set of modes.
- $O_j$ is a number of opportunities at $j$, in our case weighted.
- $c_{ij}^m$ is the travel cost between $i$ and $j$ for each $m$.
- $f^m(\cdot)$ is an impedance function of $c^m_{ij}$ for each $m$; within the cumulative opportunity approach, it is a binary function that takes the value of 1 if $c^m_{ij}$ is less than a selected value.
- $A^m_{i}$ is the unconstrained accessibility for $m$ at each $i$.

**Spatial availability** takes the following general form for multi-mode calculation:
$$
V^m_{i} = \sum_{j=1}^J O_j\ F^{tm}_{ij}
$$
\noindent Where: 

- $i$, $j$, and $m$ is a set of origin locations, destination locations, and modes respectively.
- $O_j$ is a number of opportunities at $j$, in our case weighted.
- $F^{tm}_{ij}$ is a balancing factor for each $m$ at each $i$. It depends on the size of the populations at different locations that demand opportunities $O_j$, as well as the cost of movement in the system $f(c_{ij})$.
- $V^m_{i}$ is the constrained accessibility (spatial availability) for $m$ at each $i$; the sum of $V^m_{i}$ for all $m$ at each $i$ is equivalent to the total sum of opportunities in the region (i.e., $\sum_j O_j = \sum_i V_i = \sum_{m} \sum_{i} V^m_{i}$).

What makes spatial availability stand apart from other competitive measures is the multimodal balancing factor $F^{tm}_{ij}$ (discussed in the pre-print by Soukhov et al. [@soukhovMultimodalSpatialAvailability2023]). $F^{tm}_{ij}$ implements a proportional allocation mechanism that ensures the sum of all spatial availability values at each $i$ always matches the total number of opportunities in the region. $F^{tm}_{ij}$ consists of two parts: the first is a population-based proportional allocation factor $F_i^{pm}$ that models the mass effect of the gravity model and the second is an impedance-based proportional allocation factor $F_{ij}^{cm}$ that models the cost effect. Both factors consider competition: $F^{pm}_{i}$ estimates a proportion of how many people are in each $i$ and using each $m$ relative to the region and $F^{cm}_{ij}$ estimates a proportion of the cost of travel from $i$ to $j$ at each $i$ using each $m$ relative to the region. As both $F^{pm}_{i}$ and $F^{mc}_{i} $ are proportions, $\sum_{m} \sum_{i} F^{pm}_{i} = 1$ and $ \sum_{m} \sum_{i} F^{cm}_{i}  = 1$). Both factors are combined to equal the total balancing factor $F^{tm}_{ij}$ which is used to calculated $V^m_i$ as follows:

$$
F^{tm}_{ij} = \frac{F^{pm}_{i} \cdot F^{cm}_{ij}}{\sum_{m=1}^M \sum_{i=1}^N F^{pm}_{i} \cdot F^{cm}_{ij}}
$$
\noindent Where:

- The factor for allocation by population for each $m$ at each $i$ is $F^{pm}_{i} = \frac{P_{i}^m}{\sum_{m}\sum_{i} P_{i}^m}$. This factor makes opportunities available based on demand. The pop
- The factor for allocation by cost of travel for each $m$ at $i$ is $F_{ij}^{cm} = \frac{f^m(c_{ij}^m)}{\sum_{m} \sum_{i} f^m(c_{ij}^m)}$. This factor makes opportunities available preferentially to those who can reach them at a lower cost.

The use of both constrained and unconstrained accessibility measures is strategic, as they illuminate different trends. As an unconstrained measure, cumulative opportunity measure counts all the destinations that can be reached from each DA within a travel cost, for each DA. From a region-wide perspective, a destination that can be reached by multiple DAs is counted multiple times, so the sum of all cumulative opportunity values region-wide is not meaningful. However, cumulative opportunity measure is relative straightforward to implement, and has been widely used in accessibility research because of its simple computation (XX). The value is understood relative to the score in the region, XX opportunities can be accessed within 30 minutes from this neighbourhood - this is XXth percentile in the estimated region, a regionally high score. Comparisons of score within the region make sense, but substantive interpretation of levels of access between modes is hard to compare. We often seen, car provides more unconstrained access to opportunities than transit.

On the other hand, spatial availability is constrained [@soukhovIntroducingSpatialAvailability2023], it incorporates the concept of the _finite_. The spatial availability value for each mode at each DA is a count of how many destinations can be accessed by that mode out of all the destinations in the region. The sum of spatial availability values across the region is constrained to equal the total number of opportunities. Proportions of each destination (supply) are allocated to each mode at each DA based on the DA-to-region-relative population (demand for opportunities) and travel impedance (travel cost to opportunities). Unlike cumulative opportunity measure, multimodal spatial availability measures can be used to extra additional meaning between modes. It can be used to illustrate in what neighbourhoods do car-drivers access _more_ than their equal share of opportunities than transit-users and how much more, for instance. 

The travel impedance threshold used in both measures is 15 minutes and 30 minutes; each measure is calculated eight times, once for each four modes and assuming a travel time cut-off of 15 minutes or less and another assuming a travel time cut-off of 30 minutes or less. The selection of the travel time threshold was informed by the literature. Only one study to date has calculated the average travel time to all different categories of care destinations (16 minutes by car and 36 by public transport) [@grantsmithManagingChallengesCombining2016]. Other literature on travel to care trends to consider trips to one type of care category (e.g., health, or school, or grocery stores). Here, travel times vary by care category (e.g., 15 minutes to grocery shopping [@hamrickTimeCostAccess2012] or 20.45 for cancer treatments [@segelRuralurbanDifferencesAssociation2020]. In other care-related accessibility analyses, time-cut offs include 10 mins (for daycares) [@fransenCommuterbasedTwostepFloating2015] and 30 mins to 1 hr (for hospitals) [@schuurmanDefiningRationalHospital2006]. Furthermore, the use of a binary travel time threshold was selected, as opposed to more complex impedance functions, to simplify computation. As mentioned, region-specific empirical travel data regarding care-centric trip travel times is lacking, and this work establishes a methodology to streamline access to care interpretation and analysis for then that data is available (?). 

# RESULTS
In absence of people's travel behaviour and preference for care destinations - a bias in traditional travel surveys - we map access to all destinations assuming an equal weighting of the five categories. The results are described across: unconstrained access to care by mode across the city, constrained access by mode, and identification of intervention areas through equity considerations.

The cumulative opportunity accessibility plots for each mode are shown in @fig-Fig5. It visualises an unconstrained count of destinations, we can interpret it as: the more destinations that can be reached by a mode, the more potential interactions and thus the potentially better. Spatial trends between the 15 minute and 30 minute threshold plots are similar (values are coloured by quantile). We can also notice three significant findings between modes: first, the access that car provides is significantly higher relative to other modes, it sets the max. value of (`r HAM_access_15$cum_opps |> max() |> round()` opportunities for 15 min and `r HAM_access_30$cum_opps |> max() |> round()` opportunities for 30 mins) across all modes. Next, access by cycling is surprisingly also relatively high. And importantly, transit and walking access is great and pretty good, respectively, within Hamilton-Centre but this is not the same story in other communities. 

```{r plot-figure5, out.width=600}
#| label: fig-Fig5
#| fig-cap: "The cumulative opportunity measure. The number of care destinations that can be reached, per DA, within 15 mins (top) and 30 mins (bottom). Basemap shapefiles are retrieved from the 2021 Canadian census [@governmentofcanadaCensusPopulation2023], the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig5-plot_cum_opp_measures.png")
```
From @fig-Fig5, we can tell car is king, an expected outcome given the tendency of North American cities to be designed around the private car [@saeidizandRevisitingCarDependency2022]. However, access by non-car modes is great (Q3 and Q4) within many DAs in Hamilton-Centre and cycling has potential, especially in the more rural communities (Q1). However, though many households use car as a commute mode, not everyone does, wants to, or can. How does the access that car provides _out compete_ access given by other modes? Lets consider cycling. Though cycling provides access to many destinations, seeing the `r HAM_access_30$V_im |> sum()` care destinations in the City as the total, how many of those are potentially available to cyclists considering motorists greater unconstrained access? We can't answer this question using unconstrained accessibility, so lets turn to constrained accessibility, shown in @fig-Fig6.

```{r plot-figure6, out.width=600}
#| label: fig-Fig6
#| fig-cap: "The spatial availability measure. The number of care destinations that can be reached, per DA, within 15 mins (top) and 30 mins (bottom). Basemap shapefiles are retrieved from the 2021 Canadian census [@governmentofcanadaCensusPopulation2023], the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig6-plot_Savail_measures.png")
```
Assuming the population that commutes by a certain mode (@fig-Fig4) also accesses care destinations by this mode, the spatial availability per mode is displayed in @fig-Fig6. We can observe that motorists capture the most _availability_ i.e., potential access to destinations out of all destinations. This is in-part because many DAs, especially in rural communities, have 0% or exceptionally low non-car mode usage. From @fig-Fig5 we can see that non-car modes have potential, especially cycling, but @fig-Fig6 affirms that even though non-car modes may provide good access within Hamilton-Central (and some access in rural communities), they do not provide sufficient availability, even within Hamilton-Centre. The proportion of car users _and_ their competitive travel times relative to other modes allow motorists to capture more finite access to opportunities (availability). Motorist capture more availability, even in the centre of Hamilton-Centre, than all other modes. Overall, `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode =="a_car") |> dplyr::select(V_im) |> sum()) / (HAM_access_30 |> st_drop_geometry() |> dplyr::select(V_im) |> sum())) |> scales::percent()` of the spatial availability is captured by 30-minute motorists that represent only `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> mutate(car_pop = Population*perc_car) |> dplyr::select(car_pop) |> sum(na.rm=T)) / ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> dplyr::select(Population) |> sum(na.rm=T)))) |> scales::percent()` of the population; they capturing disproportionately more availability than their presence in the region. They capture this availability from non-car mode using populations that exists in high proportions by with lower spatial availability (i.e., 30-minute transit users are `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "b_transit") |> mutate(transit_pop = Population*perc_transit) |> dplyr::select(transit_pop) |> sum(na.rm=T)) / ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> dplyr::select(Population) |> sum(na.rm=T)))) |> scales::percent()` but capture `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode =="b_transit") |> dplyr::select(V_im) |> sum()) / (HAM_access_30 |> st_drop_geometry() |> dplyr::select(V_im) |> sum())) |> scales::percent()`, 30-minute cyclist are `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "c_bike") |> mutate(bike_pop = Population*perc_cycle_other) |> dplyr::select(bike_pop) |> sum(na.rm=T)) / ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> dplyr::select(Population) |> sum(na.rm=T)))) |> scales::percent()` but capture `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode =="c_bike") |> dplyr::select(V_im) |> sum()) / (HAM_access_30 |> st_drop_geometry() |> dplyr::select(V_im) |> sum())) |> scales::percent(accuracy=0.1)`, and 30-minute walkers are `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "d_walk") |> mutate(walk_pop = Population*perc_walked) |> dplyr::select(walk_pop) |> sum(na.rm=T)) / ((HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> dplyr::select(Population) |> sum(na.rm=T)))) |> scales::percent()` but capture `r ((HAM_access_30 |> st_drop_geometry() |> filter(mode =="d_walk") |> dplyr::select(V_im) |> sum()) / (HAM_access_30 |> st_drop_geometry() |> dplyr::select(V_im) |> sum())) |> scales::percent(accuracy=0.1)`).

It is difficult to tease out spatial trends in how much more availability motorists capture than other mode-users referencing @fig-Fig6, so in @fig-Fig7 we divide modal spatial availability per mode-using population. These values represent how much availability is captured per mode-using population in a DA. They are admittedly small, as each represents how many opportunities out of 2,225 destinations are available to the mode-using population in the DA (out of `r (HAM_access_30 |> st_drop_geometry() |> filter(mode == "a_car") |> dplyr::select(Population) |> sum(na.rm=T))` people residing in Hamilton). As in all other plots, each colour is a quantile so trends can be interpreted accordingly. In @fig-Fig7, the motorists capture vast majority of opportunities (Q4, dark green and dark purple), but notably this is still very much true within Hamilton-Centre, where we know there are pockets where non-car user is greater than 50%. @fig-Fig7 reinforces that if certain modes capture an exceptional amount of availability (car), than the availability left for other modes is low. Further, non-car modes have the potential to offer high access (within Hamilton-Centre) as seen in @fig-Fig5, but as it exists now (assuming modal commute share), availability to care destinations is captured by motorists even in DAs where car mode share is under 50%.   

```{r plot-figure7, out.width=600}
#| label: fig-Fig7
#| fig-cap: "The spatial availability per mode-using-capita measure. The number of care destinations that can be reached per mode-using-capita, per DA, within 15 mins (top) and 30 mins (bottom). Basemap shapefiles are retrieved from the 2021 Canadian census [@governmentofcanadaCensusPopulation2023], the Open Data Hamilton Portal [@opendatahamiltonCityBoundary2023] and the USGS [@greatlakesUSGS2010]."
knitr::include_graphics("figures/Fig7-plot_Savail_smallv_measures.png")
```
```{r correlations, include=FALSE}
car_HAM_access_30 <- HAM_access_30 |> filter(mode == "a_car") |> st_drop_geometry()
transit_HAM_access_30 <- HAM_access_30 |> filter(mode == "b_transit") |> st_drop_geometry()
bike_HAM_access_30 <- HAM_access_30 |> filter(mode == "c_bike") |> st_drop_geometry()
walk_HAM_access_30 <- HAM_access_30 |> filter(mode == "d_walk") |> st_drop_geometry()

car_HAM_access_15 <- HAM_access_15 |> filter(mode == "a_car") |> st_drop_geometry()
transit_HAM_access_15 <- HAM_access_15 |> filter(mode == "b_transit") |> st_drop_geometry()
bike_HAM_access_15 <- HAM_access_15 |> filter(mode == "c_bike") |> st_drop_geometry()
walk_HAM_access_15 <- HAM_access_15 |> filter(mode == "d_walk") |> st_drop_geometry()
```

Equity consideration and the consideration of travel time cut-off. We can see signficant difference in the correlation between LICO-AT in a DA and the modal per-capita spatial availability depending on if the 15 minute or 30 minute cut-off is considered. We can see 30 minute cut-off is more generous, especially for the motorists that can almost reach all destinations. As such, there is a weak positive correlation between for motorists (`r cor(car_HAM_access_30$LICO_AT_TOTAL, car_HAM_access_30$v_im) `) and cyclists (`r cor(bike_HAM_access_30$LICO_AT_TOTAL, bike_HAM_access_30$v_im)`). However, there is stronger positive correlation for those who walk (`r cor(walk_HAM_access_30$LICO_AT_TOTAL, walk_HAM_access_30$v_im)`) and use transit (`r cor(transit_HAM_access_30$LICO_AT_TOTAL, transit_HAM_access_30$v_im)`). This is in line with literature XX. Areas that are LICO-AT are clustered in higher density DAs in Hamilton-Centre, where unconstrained and constrained access by all modes is high but access is also high (or alright) for car and cycling in areas outside Hamilton-Centre (areas with lower LICO-AT).

However, relationships are different assuming a 15 minute cut-off; all modes see a weak but positive linear relationship between LICO-AT and per-capita modal spatial availability however trends are reversed. Cyclists and motorists now see a stronger relationship (cycle: `r cor(bike_HAM_access_15$LICO_AT_TOTAL, bike_HAM_access_15$v_im)` and motorists: `r cor(car_HAM_access_15$LICO_AT_TOTAL, car_HAM_access_15$v_im)`) than those who walk and use transit (walk: `r cor(walk_HAM_access_15$LICO_AT_TOTAL, walk_HAM_access_15$v_im)` and transit: `r cor(transit_HAM_access_15$LICO_AT_TOTAL, transit_HAM_access_15$v_im)`). As mentioned, availability is high for all modes in Hamilton-Centre where there is high LICO-AT, but especially for faster modes like car and cycling. However, access for all modes is not high outside of Hamilton-Centre. Because Car and cycling does not have such an exceptional advantage in the rural communities consider a 15-minute cut-off, the reverse trend emerges where LICO-AT is correlated more strongly with cyclist and motorist availability. This reversal in trend highlights the importance in threshold selection as accessibility results are highly sensitive to the assumptions of travel to destinations. Echos trends in literature X. Empirical data is needed, but there is a bias in excluding considerations for care destinations in conventional survey methods XX.

Overall, between the 15-minute and 30-minute cut-offs, there is a positive relationship in per-capita availability and LICO-AT as well as cumulative opportunity and LICO-AT. We know car mode provides unconstrained and constrained access to opportunities; those who have a car are covered. But we must plan for cities that are not reliant on cars. Cycling has potential, but mostly in areas with low LICO-AT and with the consideration for some risky cycling (level 1 and 2). Further, comparing access to what cars can reach may not be the best approach -- most opportunities in the city of ~500,000 can be reached within 30-minutes. Is that necessary? Should that be the goal for all modes? Or shall access by car be reduced while access by other modes increased such that availability matches the proportion of the mode-using population. Spatial availability can be used to consider these options. 

# DISCUSSION AND CONCLUSION
<!-- needs more work-->

<!-- Spatial availabiltiy -- it's not that people are competing for destinations in a traditional sense, it's that there is a finite something. That something is opportunities in our case. To judge one person's accessibiltiy is must be placed relative to anothers. Those who drive have access to many options. Those who do not drive, do not have that same access. But how can we compare this? using the concept of the finite and spatial availability. People who drive can access more opportunities of the total number of opportunities in the region. People who do not drive, and have lower unconstrained access, thus have even _lower_ spatial availability to opportunities as those who drive are able to access a higher proportion of them. Availability is one way of comparing this. -->
<!-- 	Further, people who do not drive are likely to be LICO-AT (thus not owning a car). Highly correlated -- LICO-AT prevelance and using another mode.  -->
This paper is first to conduct an exploratory feminist accessibility analysis of care destinations – one that counters the current literature’s emphasis on employment-related travel, a travel more significant for men, and especially wealthy and educated men [@robinlawWomenTransportNew1999; @hansonGenderMobilityNew2010]. Its aim is to challenge assumptions often made in transport planning tools (i.e., that work is the most important place to access), and to provide a tangible example of how one could gender-mainstream accessibility analyses. 

This study also contributes to the literature on sustainable travel behaviour. Results indicate that care is most easily accessed in Hamilton by car, an unsurprising result given its car-oriented design. Previous research has found that mobility of care are more frequently completed by car or by foot than by transit or by bicycle [@ravensbergenExploratoryAnalysisMobility2022]. It is possible that the car’s ability to provide higher access to care destinations, as observed in this study, shapes this tendency to complete care trips by car. Then again, car use may be more frequent for care trips because these trips tend to involve carrying things (e.g., groceries) or people (e.g., children). Indeed, past qualitative work has found that many prefer travelling by car for this type of trip due to convenience and increased safety [@maciejewskaHaveChildrenThus2019; @carverParentalChauffeursWhat2013]. Then again, care trips tend to be shorter than other trips  [@ravensbergenExploratoryAnalysisMobility2022], making them ideal for more sustainable travel modes, such as active modes (walking, cycling) and public transport. The low access to care by foot identified in this study is discouraging, given both people’s tendency to use this mode for care trips  [@ravensbergenExploratoryAnalysisMobility2022], and the benefits of walking as a travel mode, both for individuals, cities, and the environment. Somewhat unexpectedly, access to care was found to be low by transit and by foot and relatively high by bicycle. Given that low income women, in particular, seem to be transit reliant for care trips [@ravensbergenExploratoryAnalysisMobility2022], this result highlights both a potential bias against care trips by transit and the equity implications of that bias. Though past work has found that many barriers exist for cycling for care [@ravensbergenVelomobilitiesCareLowcycling2020; @ravensbergenFeministGeographiesCycling2019; @sersliRidingAloneTogether2020], the results of this study highlight the great potential of the bicycle for easily accessing care. 

The preliminary nature of this research also comes with its limitations as a result of data availability. Firstly, the travel time estimations assume free-flow network conditions: this may not drastically impact walking travel time accuracy, but could impact car, transit and cycling estimations. Secondly, the geometric centroids of DAs (origins) and destinations (all care destinations) were used as inputs for travel time calculations. DAs are created for the purpose of the census: they vary in area and centroids may not necessarily align with where that population may be beginning their journey to care destinations. Thirdly, the cumulative opportunity accessibility measure is unconstrained and does not consider competition. It is the sum of every care destination that can be possibly reached, not taking into consideration the density of neighbouring population that may also be reaching those destinations. Fourthly, quality of the care destinations was not considered (e.g., access to a park is equal to access to a school). These limitations all contribute to how accurately results reflect the quantitative access to care landscape within Hamilton.

Future work on the accessibility of care will consider competition factors through different accessibility measures, a higher spatial level of travel time estimation, and the incorporation of different weightings of care destination categories. In addition, future work will compare care accessibility to work accessibility in Hamilton to highlight the bias in planning towards jobs as well as substantive equity critiques. 

# References {-}

# Appendix

<!-- <!-- REJECTED --> 

<!-- Consider this example: a few households in the south edge of Hamilton-Centre, relatively high-density area, do not own cars but they cycle. Many of their neighbours do drive, a mode that provides the most access, even more than cycling. So more of the 2,215 destinations are available to their neighbours than the cycling households _because_ car access is high and more motorists can potentially access these opportunities. Availability is constrained accessibility; because car access is uniformly high throughout the city, availability of destinations is lower for all other modes. In this way, spatial availability estimates how many destinations can be accessed by the users of a specific mode out of all destinations in the region. -->


<!-- ```{r} -->
<!-- #st_bbox(hamilton_communities) -->
<!-- plot_hamilton_boundaries <- tm_basemap(server=providers$Esri.WorldGrayCanvas, alpha=1) + -->
<!--   tm_shape(hamilton_communities, bbox=bb(x=hamilton_communities, ext=0.5, relative=TRUE))+ -->
<!--   tm_polygons("COMMUNITY_",  palette = viridis::viridis(6), border.col = "black", lwd=1, title = "Hamilton Communities", alpha=0.7)+ -->
<!--   tm_text(text = "COMMUNITY_", size = 1, col = "black", shadow = TRUE) + -->
<!--   tm_scale_bar(position = c("left", "bottom")) -->
<!--   #tm_compass(position = c("left", "top"), size = 1.0, north = -20) -->
<!-- plot_hamilton_boundaries <- tmap_leaflet(plot_hamilton_boundaries) -->
<!-- mapshot(plot_hamilton_boundaries, file ="figures/Fig1-boundaries.png") -->
<!-- ``` -->

<!-- ```{r creating-table-of-category-definitions} -->
<!-- dat <- data.frame(matrix(c("*Child Centric:* This category includes the geospatial location of all child-oriented destinations such as schools, daycares, community centers, and parks. Many of the locations were identified through Open Data Hamilton [@cityofhamiltonOpenData2023] (?) and Open Data Ontario [@governmentofontarioOntarioDataCatalogue2023]. Educational Institution data for Hamilton [@opendatahamiltonEducationalInstitutions2022] (?) was used for the care category specific “Schools”. The data was then filtered, and the following categories found from the dataset were removed: Post-Secondary, Adult-Learning Centres, Group Homes, and Foster Care Centres. The reason for eliminating these categories was due to these locations not centering on the age demographics of children. Through close examination, within the Educational Institution data, some Section 23 institutions [@governmentofontarioministryofeducationFundingEducationCommunity2023], which are defined as “centres for children who cannot attend school to meet the needs of care or treatment, and rehabilitation” [@governmentofontarioministryofeducationFundingEducationCommunity2023], were kept due to their innate connection to care. -->
<!--                            Care category specific “Daycare” data was identified from the Ontario Open Data Portal [@governmentofontarioOntarioDataCatalogue2023] for Registered Child Care Facilities in Ontario and filtered to Hamilton. EarlyON, childcare locations, which are defined as “…locations for child rearing and development where parents accompany their children” [@cityofhamiltonChildCareRegistry2023], were added manually from the Hamilton Child Care Registry [@cityofhamiltonChildCareRegistry2023], and were given the category “Daycare EarlyON”. -->

<!-- Recreation and community centre data was identified from Open Data Hamilton [@opendatahamiltonRecreationCommunityCentres2022], and filtered into their own respective specific care categories. Parks were also gathered from Open Data Hamilton [@opendatahamiltonParksdataset2022].",  -->
<!--                            "*Elder Centric:* The Elder Centric destinations include senior centres, long-term care homes, and retirement homes. Long-term care home and retirement home data was derived from the Ontario Ministry of Health GEOHub for Health Service Locations [@ontarioministryofhealthgeohubMinistryHealthService2023]. Senior centres were derived from the Recreation and Community Centre dataset from Open Data Hamilton [@opendatahamiltonRecreationCommunityCentres2022].",  -->
<!--                            "*Errand Centric:* Errand centric travel is a route many families embark on, which is often remised in previous studies and supplemented with a broader category of trip being grocery shopping [@taylorWhatExplainsGender2015]. For this research errand centric destinations include libraries, post offices, and banks. Library data was derived from Hamilton Open Data Portal [@opendatahamiltonLibraries2022]. Post Offices were collected from two sources; Axle dataset and then supplemented from the Canada Post Postal Office Tracker Website [@axledataConsumerData2023;@canadapostPostOfficeLocator2023]. The supplemented locations from Canada Post Postal Office Tracker Website were manually entered into the dataset to ensure data was accurately being represented from its source. Banks were also derived from Axle Data and then cross referenced to ensure data quality with the ABM Bank Locator websites for the following banking firms: Bank of Montreal, CIBC, HSBC, National Bank of Canada, Royal Bank of Canada, Scotiabank and TD Financial [@bankofmontrealBankMontrealBranch2023; @thehongkongandshanghaibankingcorporationlimitedhsbcHSBCBranchABM2023; @nationalbankNationalBankBranches2023; @royalbankofcanadaRBCBranchABM2023; @scotiabankScotiabankABMBranch2023; @thetorontodominionbankTDBankBranch2023].", -->
<!--                            "*Grocery Centric:* This category includes all grocery stores, regardless of size, from convenience stores to large retail stores. Data was gathered from Data Axle through the McMaster University Library and filtered by Company Name, Suite Number, Address, City, Province, Phone Number and Postal Code [@axledataConsumerData2023]. From there it was separated by type of grocery store, (grocers specialty foods, grocers retail, grocer health food, grocer wholesale, grocer curbside, grocer delicatessen wholesale, grocer convenience). After data was compiled, it was cross referenced to ensure that all stores were operational, and legitimate grocery stores. Some locations were removed for being closed permanently, for being food distribution warehouses, or because they would have been double counted in two different categories. ", -->
<!--                            "*Health Centric:* Health destinations include hospitals, clinics, pharmacies, and dentist offices. As was the case for the Elder Centric locations, Hospitals and Pharmacies were derived from the Ontario Ministry of Health GEOHub for Health Service Locations [@ontarioministryofhealthgeohubMinistryHealthService2023]. Clinic location data was manually entered with data being gathered from Hamilton Niagara Haldimand Brant Health Line – Health Service Locations [@hamiltonniagarahaldimandbranthealthlineWalkInMedicalClinics2023]. Clinic data was then double checked to ensure locations were in operation. Dentistry locations were also manually entered through Google Map search filtering as well as reassessed for operational use. -->

<!-- Once the care destinations were compiled and arranged in separate spreadsheets according to their care category, the data was validated to ensure that duplicate locations were removed. Then, quality controls were conducted on all non-open source data to ensure that each location was in operation. This was done by examining each location manually through Google Maps. As a result, all locations that were permanently closed were manually removed. Within the Recreation and Community Centre data, locations were not given an innate category, therefore any location that was not previously categorized as a “Senior Centre” and involved physical activity was categorized as “Recreation Centre”, the rest being categorized as “Community Centre”. The complete care destination dataset was imported into RStudio for further processing."),  -->
<!-- ncol = 2, byrow = T)) |> flextable() |> ftExtra::colformat_md()  -->
<!-- ``` -->

<!-- ```{r, message=TRUE} -->
<!-- set_flextable_defaults(font.size= 7, -->
<!--                        font.family = NULL, -->
<!--                        text.align = 'justify') -->

<!-- dat |> -->
<!--   compose(i = 1, j = c(1,2), -->
<!--           part = "header", value = as_paragraph(c("Destination Categories", "Destination Categories"))) |> -->
<!--   merge_v(j=2) |> #merge 'Visualisation' column -->
<!--   width(j=1, width=3.25) |> -->
<!--   width(j=2, width=3.25) |> -->
<!--   set_table_properties(layout = "fixed") -->

<!-- ``` -->


<!-- HERE IS THE CODE FOR MAKING PLOTS THAT VISUALIZE ONLY 1 MODE SPATIAL AVAILABILITY, FOR EACH MODE-->
<!-- ```{r} -->
<!-- ttm_car_30 <- ttm_care_car |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 30, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_30 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_walk_30 <- ttm_care_walk |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 30, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_30 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_bike_30 <- ttm_care_bike |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 30, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_30 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_transit_30 <- ttm_care_transit |> -->
<!--   mutate(f = ifelse(travel_time_p25 <= 30, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_30 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- #15 mins or less -->
<!-- ttm_car_15 <- ttm_care_car |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 15, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_15 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->


<!-- ttm_walk_15 <- ttm_care_walk |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 15, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_15 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_bike_15 <- ttm_care_bike |> -->
<!--   mutate(f = ifelse(travel_time_p50 <= 15, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_15 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_transit_15 <- ttm_care_transit |> -->
<!--   mutate(f = ifelse(travel_time_p25 <= 15, 1, 0), -->
<!--          Dest_count = 1) |> -->
<!--   merge(HAM_access_15 |> select(c("GeoUID", "Population", "perc_walked", "perc_car", "perc_transit", "perc_cycle_other")) |> st_drop_geometry(), by.x = "from_id", by.y = "GeoUID") -->

<!-- ttm_ALL_30 <- rbind(ttm_car_30, ttm_walk_30, ttm_bike_30,ttm_transit_30) -->
<!-- rm(ttm_car_30, ttm_walk_30, ttm_bike_30,ttm_transit_30) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- ttm_car_30 <- ttm_car_30 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, #the DA centroid -->
<!--                     d_id = to_id, #the care destination point -->
<!--                     pop = Population, #the population of the DA using that mode -->
<!--                     opp = Dest_count, -->
<!--                     r = catch, -->
<!--                     f = f, -->
<!--                     alpha = 1)|> -->
<!--   group_by(from_id) |> -->
<!--   summarize(V_i = sum(V_ij, na.rm = TRUE)) |> -->
<!--   mutate(mode = "a_car") -->

<!-- ttm_walk_30 <- ttm_walk_30 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE)) |> -->
<!--   mutate(mode = "d_walk") -->

<!-- ttm_bike_30 <- ttm_bike_30 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "c_bike") -->

<!-- ttm_transit_30 <- ttm_transit_30 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "b_transit") -->

<!-- ttm_car_30$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_transit_30$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_bike_30$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_walk_30$V_i |> sum(na.rm = TRUE) -->

<!-- #now 15 mins -->
<!-- ttm_car_15 <- ttm_car_15 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "a_car") -->

<!-- ttm_walk_15 <- ttm_walk_15 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "d_walk") -->

<!-- ttm_bike_15 <- ttm_bike_15 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "c_bike") -->

<!-- ttm_transit_15 <- ttm_transit_15 |> -->
<!--   mutate(catch = 1) |> -->
<!--   sp_avail_detailed(o_id = from_id, d_id = to_id, pop = Population, opp = Dest_count, r = catch, f = f, alpha = 1)|> -->
<!--   group_by(from_id) |> summarize(V_i = sum(V_ij, na.rm = TRUE))|> -->
<!--   mutate(mode = "b_transit") -->

<!-- ttm_car_15$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_transit_15$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_bike_15$V_i |> sum(na.rm = TRUE) -->
<!-- ttm_walk_15$V_i |> sum(na.rm = TRUE) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- #attaching the cum opps to sf object for mapping. First the 30 mins. -->
<!-- HAM_access_30_1 <- HAM_access_30 |> merge(ttm_car_30, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_30_2 <- HAM_access_30 |> merge(ttm_transit_30, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_30_3 <- HAM_access_30 |> merge(ttm_bike_30, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_30_4 <- HAM_access_30 |> merge(ttm_walk_30, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->

<!-- HAM_access_30 <- rbind(HAM_access_30_1, HAM_access_30_2, HAM_access_30_3, HAM_access_30_4) -->
<!-- remove(HAM_access_30_1,HAM_access_30_2,HAM_access_30_3,HAM_access_30_4) -->

<!-- # the 15 mins -->
<!-- HAM_access_15_1 <- HAM_access_15 |> merge(ttm_car_15, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_15_2 <- HAM_access_15 |> merge(ttm_transit_15, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_15_3 <- HAM_access_15 |> merge(ttm_bike_15, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->
<!-- HAM_access_15_4 <- HAM_access_15 |> merge(ttm_walk_15, by.x = c("GeoUID", "mode"),by.y = c("from_id", "mode")) -->

<!-- HAM_access_15 <- rbind(HAM_access_15_1, HAM_access_15_2, HAM_access_15_3, HAM_access_15_4) -->
<!-- remove(HAM_access_15_1,HAM_access_15_2,HAM_access_15_3,HAM_access_15_4) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- #plotting the spatial availability measure results -->
<!-- plot_Savail_30m <- -->
<!--   tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) + -->
<!--   tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+ -->
<!--   tm_shape(HAM_access_30) + -->
<!--   tm_polygons("V_i", -->
<!--               palette = "Purples", -->
<!--               # breaks = c(0,0.0001, 66, 246, 753, 2215), -->
<!--               # labels = c("0",">0 to <66", "66 to <246", "246 to <753", "753 to 2215"), -->
<!--               border.alpha = 0, -->
<!--               title = "Spatially available destinations within 30 mins.", -->
<!--               legend.is.portrait = FALSE) + -->
<!--   tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+ -->
<!--   tm_shape(hamilton_communities) + tm_polygons(alpha=0)+ -->
<!--   tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) + -->
<!--   tm_compass(position = c("right", "top"), size=1.0)+ -->
<!--   tm_layout(panel.labels=c("Car","Transit","Bike","Walk"), -->
<!--             bg.color = "grey", -->
<!--             panel.label.bg.color = "white", -->
<!--             panel.label.color = "black", -->
<!--             legend.outside = TRUE, -->
<!--             legend.position = c("center", "bottom"), -->
<!--             legend.outside.position = "bottom", -->
<!--             legend.outside.size = 0.2, -->
<!--             legend.title.size = 0.7, -->
<!--             legend.text.size = 0.5) -->

<!-- plot_Savail_15m <- -->
<!--   tm_shape(ham_bay, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0) + -->
<!--   tm_shape(hydro_p_LakeOntario, bbox=hamilton_communities) + tm_polygons(col="skyblue", border.alpha = 0)+ -->
<!--   tm_shape(HAM_access_15) + -->
<!--   tm_polygons("V_i", -->
<!--               palette = "Greens", -->
<!--               # breaks = c(0,0.0001, 12,47,242,1818), -->
<!--               # labels = c("0",">0 to <12", "12 to <47", "47 to <242", "242 to 1818"), -->
<!--               border.alpha = 0, -->
<!--               title = "Spatially available destinations within 15 mins.", -->
<!--               legend.is.portrait = FALSE) + -->
<!--   tm_facets(by=c("mode"), nrow=1, showNA = FALSE)+ -->
<!--   tm_shape(hamilton_communities) + tm_polygons(alpha=0)+ -->
<!--   tm_scale_bar(position = c("left", "bottom"), breaks = c(0, 1, 5, 10, 20)) + -->
<!--   tm_compass(position = c("right", "top"), size=1.0)+ -->
<!--   tm_layout(panel.labels=c("Car","Transit","Bike","Walk"), -->
<!--             bg.color = "grey", -->
<!--             panel.label.bg.color = "white", -->
<!--             panel.label.color = "black", -->
<!--             legend.outside = TRUE, -->
<!--             legend.position = c("center", "bottom"), -->
<!--             legend.outside.position = "bottom", -->
<!--             legend.outside.size = 0.2, -->
<!--             legend.title.size = 0.7, -->
<!--             legend.text.size = 0.5) -->
<!-- plot_Savail_measures <- tmap_arrange(plot_Savail_15m, plot_Savail_30m, asp=1/1.5) -->
<!-- plot_Savail_measures -->
<!-- #tmap_save(plot_cum_opp_measures, filename ="figures/Fig4-plot_cum_opp_measures.png", dpi=600) -->
<!-- #rm(plot_cum_opp_15m,plot_cum_opp_30m) -->
<!-- ``` -->
